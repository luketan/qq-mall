<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//configs.mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.honglinktech.zbgj.dao.UserSearchHotWordDao">
    <!-- Mappers -->

    <select id="findById"
            parameterType="int"
            resultType="com.honglinktech.zbgj.entity.UserSearchHotWord">
        select
        id,
        module,
        search_keyword as searchKeyword,
        amount,
        is_system as isSystem,
        update_date as updateDate,
        delete_flag as deleteFlag
        from tb_user_search_hot_word where id = #{id}
    </select>

    <!-- 保存 -->
    <insert id="save"
            parameterType="com.honglinktech.zbgj.entity.UserSearchRecord"
            useGeneratedKeys="true" keyProperty="id">
        <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="id">
            SELECT LAST_INSERT_ID() AS ID
        </selectKey>
        INSERT INTO tb_user_search_hot_word
        (
        module,
        search_keyword,
        amount,
        is_system,
        update_date,
        delete_flag
        )
        VALUES
        (
        #{module},
        #{searchKeyword},
        #{amount},
        #{isSystem},
        now(),
        0
        )
    </insert>

    <!-- 更新-->
    <update id="update"
            parameterType="com.honglinktech.zbgj.entity.UserSearchRecord">
        UPDATE tb_user_search_hot_word
        SET
        module=#{module},
        search_keyword=#{searchKeyword},
        amount=#{amount},
        is_system=#{isSystem},
        <if test="userId!=null">
            user_id=#{userId},
        </if>
        <if test="deleteFlag!=null">
            delete_flag=#{deleteFlag},
        </if>
        update_date=now()
        WHERE
        id=#{id}
    </update>


    <!--<update id="updateAll"-->
            <!--parameterType="string">-->
        <!--UPDATE tb_user_search_hot_word-->
        <!--SET-->
        <!--delete_flag=1,-->
        <!--update_date=now()-->
        <!--WHERE-->
        <!--module=#{module} and is_system=0-->
    <!--</update>-->

    <update id="updateAll"
            parameterType="string">
        delete from tb_user_search_hot_word where   module=#{module} and is_system=0
    </update>
    <!--查询热门关键字-->
    <select id="findByModulePage" parameterType="map"
            resultType="com.honglinktech.zbgj.entity.UserSearchHotWord">
        select
        id,
        search_keyword as searchKeyword,
        max(amount) as amount,
        max(is_system) as isSystem
        from tb_user_search_hot_word h where h.module=#{module} group by search_keyword
        ORDER BY h.is_system DESC,h.amount DESC
        <if test="start!=null and rows!=null">
            LIMIT #{start}, #{rows}
        </if>

    </select>

    <select id="findByModuleCount" parameterType="map"
            resultType="int">
        select
        id
        from tb_user_search_hot_word h where h.module=#{module} group by search_keyword
    </select>
    <!--查询所有的总数-->
    <!--<select id="findByUserIdCount" parameterType="map"-->
    <!--resultType="int">-->
    <!--SELECT-->
    <!--count(u.id) AS totalRecord-->
    <!--FROM tb_new_product  p ,tb_user_product_collection  u ,tb_product_category  c,tb_product_series s ,tb_exhibition e-->

    <!--WHERE p.category_id=c.id-->
    <!--AND p.series_id=s.id-->
    <!--AND p.exhibition_id=e.id-->
    <!--AND p.id=u.product_id-->
    <!--AND p.delete_flag=0-->
    <!--AND s.delete_flag=0-->
    <!--AND c.delete_flag=0-->
    <!--AND e.delete_flag=0-->
    <!--AND u.delete_flag=0-->
    <!--AND u.user_id=#{userId}-->
    <!--ORDER BY p.update_date DESC-->

    <!--</select>-->


</mapper>
